{% extends "index_lazy_layout.html" %}

{% block title %}Profireader - Create article{% endblock title %}

{% block portal_content %}


    <script>
        module.controller('article_list', ['$scope', '$ok', function ($scope, $ok) {
            $scope.url_details = {{ raw_url_for('article.details')|safe }};
            $scope.url_create_article = {{ raw_url_for('article.show_form_create')|safe }};
            $scope.data = {};
            $scope.url_list = {{ raw_url_for('article.show_mine')|safe }};
            $scope.url_search_article = '{{ url_for('article.load_mine')|safe }}';
            $scope.cancel = function () {
                window.location.href = $scope.url_back();
                return false;
            };
            $scope.getData = function () {
                return $scope.data;
            };
            $scope.afterSave = function (resp) {
                $scope.data = resp;
            };
            $scope.getCompanies = [];
            $scope.getCompaniesFunc = function(submitted_viersions){
{#                var array = {};#}
{#              for(c in submitted_viersions){#}
{#                  array[c.company.name] = c.company.status#}
{#              }#}
                $scope.getCompanies = submitted_viersions
            };

        }])
    </script>
    {% raw %}
    <div ng-init="loadData()" ng-controller="article_list">
        <div ng-if="loading">Loading...</div>
        <div ng-if="!loading">
            <h2><a href="{{ url_create_article() }}">Create article</a></h2>
                            <form
                ng-ok
                ng-onsuccess="afterSave"
                ng-onsubmit="getData"
                ng-action="url_search_article">
                    <input type="submit" value="search">
                </form>
            <table style="width:114%">



                    <tr><td></td><td><input type="text" placeholder="Search" ng-model="data.search_text"></td><td><select ng-model="data.chosen_company" ng-options="comp.name for comp in data.companies"><option value="" selected hidden></select></td><td></td></tr>

                  <tr><td width="400px">&nbsp;&nbsp;Date</td><td width="120px">&nbsp;&nbsp;&nbsp;Title</td><td width="120px">Campanies</td><td><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Status</p></td></tr></table>
            <table style="width:100%" ng-repeat="article_dict in data.articles">

                <tr ng-if="article_dict.company_count>1">
                    <td rowspan="{{ article_dict.company_count }}" width="300px">{{ article_dict.article.mine_version.md_tm }}</td>
                    <td rowspan="{{ article_dict.company_count }}" width="200px">{{ article_dict.article.mine_version.title }}</td>
                </tr>
                <tr ng-if="article_dict.company_count>1" ng-repeat="companies in article_dict.article.submitted_versions"><td width="200px">{{ companies.company.name }}</td><td width="150px">{{ companies.status }}</td></tr>
                <tr ng-if="article_dict.company_count==1"><td  width="300px">{{ article_dict.article.mine_version.md_tm }}</td>
                    <td  width="200px">{{ article_dict.article.mine_version.title }}</td><td width="200px">Not sent to any company yet</td><td width="150px">Not sent</td></tr>


            </table>

        </div>
    </div>
    {% endraw %}
{% endblock portal_content %}
