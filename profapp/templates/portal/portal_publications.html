

{% extends "index_lazy_layout.html" %}

{% block title %}Profireader - Articles{% endblock title %}

{% block portal_content %}


    <script>
        module.controller('article_list', ['$scope', '$ok', '$sce', function ($scope, $ok, $sce) {
            angularControllerFunction('CompanyMenuController', 'set_selected_company_menu')('publications');
            $scope.url_details = {{ raw_url_for('portal.publication_details')|safe }};
            $scope.url_search_article = {{ raw_url_for('portal.publications_load')|safe }};

            $scope.own_company_id = '{{ company_id }}';
            $scope.$$translate = {{ translates('article_list')|safe }};

            {% raw %}
            $scope.noData = 'No publications';

            $scope.sendData = function (data) {
                $scope.loading = true;
                console.log($scope.own_company_id)
                $ok($scope.url_search_article({company_id: $scope.own_company_id}), data, function (resp) {
                    $scope.datas = resp;
                    $scope.applyGridExtarnals(resp);
                }).finally(function () {
                    $scope.loading = false;
                    $scope.load_contr = true;
                });
            };

            $scope.gridOptions1 = $.extend({}, $scope.gridOptions, {
                    onRegisterApi: function (gridApi) {
                        $scope.setGridExtarnals(gridApi)
                    },
                    columnDefs: [
                      { name: 'title', enableSorting: false,enableCellEdit: false, enableColumnMenu: false, displayName: 'Title', width: '35%',
                          type: 'link',
                          href: 'url_details({company_id:grid.appScope.own_company_id,article_id:row.entity.id})',
                          classes: 'link',
                          filter: {type:'input'}
                      },
                      { name: 'date',enableCellEdit: false, displayName: 'Date', filter: {type:'date_range'}, filters: 2 },
                      { name: 'company', enableSorting: false,enableCellEdit: false, enableColumnMenu: false, displayName: 'Company',
                          filter: {type:'select'}
                      },
                      { name: 'publication_status', enableSorting: false,displayName: 'Publication Status', enableCellEdit: false, enableColumnMenu: false,
                          filter: {type:'select'}
                      }
                    ]
                  });



        }]);
    {% endraw %}
    </script>
    {% include 'company/company_base_angular.html' %}
    {% raw %}
    <div ng-controller="article_list">
        <div ng-if="!load_contr">{{_('Loading...')}}</div>
        <div class="grid" id="grid1" ui-grid-edit ui-grid-pagination ui-grid="gridOptions1" ></div>
    </div>
    {% endraw %}

{% endblock portal_content %}


