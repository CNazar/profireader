{% extends "index_layout.html" %}
{% block title %}Profireader{% endblock title %}
{% block head %}
    {{ super() }}
{% endblock head %}

{% block portal_base %}
    {% include 'partials/portal_base_Profireader.html' %}
{% endblock portal_base %}
{% block content %}
    {% block company_base %}
        {% include 'company/company_base_angular.html' %}
    {% endblock company_base %}
    <script>
        module.controller('publication', ['$scope', function ($scope) {
            $scope.publications = {{ raw_url_for('portal.publications')|safe }};
            $scope.url_update_status = '{{ url_for('portal.update_article_portal')|safe }}';
            $scope.getData = function () {return $scope.data;};
            $scope.afterSave = function (resp) {window.location.href = $scope.publications({company_id: resp.company_id})};
            $scope.myRights = function(right){for (i = 0; i < $scope.data.user_rights.length; i++) {
                if (right == $scope.data.user_rights[i]) {
                    return true;
                }
            }};
        }]);
    </script>
    {% raw %}
    <div ng-init="loadData()" ng-controller="publication">
    <div ng-if="myRights('publish')">
        <form  ng-ok ng-onsuccess="afterSave" ng-onsubmit="getData" ng-action="url_update_status">
            <div ng-repeat="dat in data.portal">
                <div ng-repeat="article in dat.article_portal">

                    <div ng-if="article.status!='published'">
                        <input type="hidden" ng-model="data.not_published">
                        Your portal rejected materials: {{ article.title }} from company
                        <span ng-repeat="company in article.company_article">
                            {{ company.name }}
                        </span>
                        Change status to :
                        <select ng-model="data.new_status">
                            <option value="{{ article.id }}/published">published</option>
                            <option value="{{ article.id }}/declined">declined</option>
                        </select>
                        <input type="submit" ng-if="data.new_status" value="Accept">
                        <input type="submit" ng-if="!data.new_status" value="Accept" disabled>
                    </div>
                </div>
            </div>
        </form>
        </div>
        <h4>Published materials :</h4>
        <div ng-repeat="dat in data.portal">
            <div ng-repeat="article in dat.article_portal">
                <span ng-if="article.status=='published'">

                         -----------------------------------------------------
                    <form  ng-ok ng-onsuccess="afterSave" ng-onsubmit="getData" ng-action="url_update_status">
                    <h5>
                        {{ article.title }}
                    </h5>
                        was published at <h6>{{ article.md_tm }}<br></h6>
                        <div ng-if="myRights('publish')">
                        Change status to :
                        <select ng-model="data.new_status">
                            <option value="{{ article.id }}/not_published">reject</option>
                        </select>
                        </div>
                        <input type="submit" ng-if="data.new_status" value="Accept">
                        <input type="submit" ng-if="!data.new_status" value="Accept" disabled><br>
                         -----------------------------------------------------
                    </form>

                </span>
            </div>
        </div>
    </div>
    {% endraw %}

{% endblock content %}

{% block footer %}
    {% include 'partials/portal_footer_Profireader.html' %}
{% endblock footer %}