"use strict";window.stringify=window.JSON?JSON.stringify:function(e){if("string"==typeof e)return'"'+e.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\n/g,"\\n").replace(/\r/g,"\\r")+'"';if("number"==typeof e)return e.toString();if(null==e)return"null";if(void 0==e)return"undefined";if(void 0!=e.length)return"["+$.map(e,stringify).join(",")+"]";var t="{";for(var n in e)t=t+stringify(n)+":"+stringify(e[n])+",";return t.length>1&&(t=t.substr(0,t.length-1)),t+"}"};var openid={"is_signup_page":null,"is_login_page":null,"is_add_login_page":null,"is_password_page":null,"needs_catpcha":null,"using_universal_ui":!1,"facebook_app_id":void 0,"facebook_login_params":{"scope":"email"},"localKey":"signup-prefs","prefs":{},"provider_url":null,"getPrefs":function(){if(window.localStorage){var e;try{e=window.localStorage.getItem(this.localKey)}catch(t){}e&&(this.prefs=$.parseJSON(e))}return this.prefs},"setPref":function(e,t){if(window.localStorage){this.prefs[e]=t;try{window.localStorage.setItem(this.localKey,stringify(this.prefs))}catch(n){}}},"init":function(e,t,n,i,a,o){if(openid.is_signup_page=e,openid.is_login_page=t,openid.is_add_login_page=n,openid.is_password_page=i,openid.needs_catpcha=a,openid.using_universal_ui=o||!1,$("#openid_form").submit(this.submitx),o||$("#more-options-link").on("click",openid.toggleExtraProviders),$("#openid-buttons").on("click",".preferred-login",function(e){openid.is_login_page&&StackExchange.using("gps",function(){StackExchange.gps.track("login.start",{},!0)}),openid.is_signup_page&&StackExchange.using("gps",function(){StackExchange.gps.track("signup.start",{"location":"signup_page"},!0)}),$(this).data("provider")&&openid.signin($(this),e,!0)}),$(".preferred-login").on("click",'.large-username input[type="button"]',function(e){var t=$(e.target).parent().find('input[name="username-large"]').val();$("#openid_form").find("#openid_username").val(t),$("#openid_form").submit()}),openid.is_signup_page){var r=null,s=null,c=$('input[name="password"]'),l=$('input[name="password2"]'),u=function(){if(0==c.val().length&&0==l.val().length){var e=function(e){return e.pStart+"Password must contain at least eight unique characters, including:"+e.pEnd+" "+e.listStart+" "+e.itemStart+" uppercase letters "+e.itemEnd+" "+e.itemStart+" lowercase letters "+e.itemEnd+" "+e.itemStart+" numbers or symbols "+e.itemEnd+" "+e.listEnd}({"pStart":"<p>","pEnd":"</p>","listStart":"<ul>","listEnd":"</ul>","itemStart":"<li>","itemEnd":"</li>"});R(b,{"id":"pw-requirements","index":-1,"attachTo":c,"message":e})}else P(b,"pw-requirements"),q(!0);for(var t=null,n=0;n<b.length;n++)if(t){var i=t.index,a=b[n].index;i>a&&(t=b[n])}else t=b[n];t?r&&s==t.attachTo?r.find(".message-text").html(t.message):(r&&(r.remove(),s=null),s=t.attachTo,r=StackExchange.helpers.showMessage(s,t.message,{"position":{"my":"left top","at":"right center"},"css":{"width":"120px;","color":"#fff"},"closeOthers":!1,"dismissable":!1,"type":"info"})):r&&(r.remove(),r=null,s=null)};$('input[name="password"], input[name="password2"]').on("keyup focus paste",u),$('input[name="submit-button"]').click(function(){r&&(r.remove(),r=null,s=null)})}var d=$('<div class="caps-lock-warning"></div>').text("Caps lock is on"),h=$('input[name="password"]'),f=!1;h.keypress(function(e){var t=String.fromCharCode(e.which),n=/[a-z]/i.test(t);if(n){var i=t==t.toUpperCase();f=i&&!e.shiftKey}var a=document.msCapsLockWarningOff===!1,o=a;f&&!o?h.after(d):d.remove()}),h.blur(function(){d.remove()}),this.prefs=openid.getPrefs(),this.seLogin=$("#se-login"),this.seLogin.data("full-height",this.seLogin.height()).on("click",openid.toggleStackExchange),openid.is_login_page&&!this.prefs.showSELogin?this.collapseStackExchange(!0):$("#forgot-password").hide(),$(".large-username").hide(),this.prefs.showMoreOpenIdOptions?(openid.expandExtraProviders(!0),this.prefs.label&&this.useInputBox(this.prefs),this.highlight(this.prefs.name)):$("#show-more-options").hide(),this.prefs.provider&&(this.signin(this.prefs.provider),this.prefs.openid?(this.prefs.username&&$("#openid_username").val(this.prefs.username),$("#openid_identifier").val(this.prefs.openid)):this.prefs.oauth_server&&($("#oauth_version").val(this.prefs.oauth_version),$("#oauth_server").val(this.prefs.oauth_server)));var p=!1,g=!1;$("#se-login-form input").blur(function(e){openid.is_signup_page&&(""==$(e.target).val()||p||(StackExchange.gps.track("signup.start",{"location":"signup_page"},!0),p=!0)),openid.using_universal_ui&&openid.is_login_page&&(""==$(e.target).val()||g||(StackExchange.gps.track("login.start",{},!0),g=!0))}),$("#se-pw-reset input").blur(function(e){var t=T();return t||(M(),e.preventDefault()),t}),$("#se-pw-reset").submit(function(e){var t=T();return t||(M(),e.preventDefault()),t}),$("#se-login-form input[type='text'], #se-login-form input[type='password'], #se-login-form input[type='email']").keypress(function(e){return 13==e.which?($("#se-login-form input[name='submit-button']").click(),e.preventDefault(),!1):void 0});var m=!0;$("#se-login-form input[name='submit-button']").click(function(){var e={"isSignup":openid.is_signup_page,"isLogin":openid.is_login_page,"isPassword":openid.is_password_page,"isAddLogin":openid.is_add_login_page,"hasCaptcha":$("#recaptcha_response_field").length>0};$("#se-login-form input").each(function(t,n){var i=$(n).attr("name");i=i.replace(/(\W|_)/gi,""),e[i]=$(n).val()}),$.ajax({"url":"/users/login-or-signup/validation/track","data":e,"type":"POST","complete":function(){var e=T();return m&&($("#se-login-form input").blur(function(){if(T(),openid.is_signup_page){var e=$("#se-login-form input[name='email']"),t=$.trim(e.val());P(v,"em-ajax"),$.ajax({"type":"POST","url":"/users/signup/email/validate","data":{"email":t},"success":function(t){openid.isSeForm()&&(t.IsValid?k=null:(R(v,{"id":"em-ajax","index":1,"attachTo":e,"message":t.ErrorMessage}),k=I(v,k)))},"complete":function(){M()}})}else M()}),m=!1),e?($("#se-login-form").submit(),void 0):(M(),void 0)}})});var v=[],b=[],w=[],x=[],y=[],k=null,S=null,C=null,E=null,T=function(){return q(),openid.is_signup_page&&(U(),D()),openid.is_password_page||L(),k=I(v,k),S=I(b,S),C=I(w,C),E=I(x,E),null==k&&null==S&&null==C&&null==E},I=function(e,t){if(e.length>0){if(null!=t){for(var n=!0,i=0;i<e.length;i++)if(e[i].message==t.message){n=!1;break}e[0].changed=n}return e[0]}return null!=t&&t.popup&&t.popup.fadeOutAndRemove(),null},M=function(){(openid.isSeForm()||openid.using_universal_ui)&&(A(k),A(S),A(E),A(C)),setTimeout(_,200)},_=function(){for(var e=0;e<y.length;e++)y[e]&&y[e].fadeOutAndRemove();y=[]},A=function(e){null!=e&&(e.popup||(e.popup=StackExchange.helpers.showMessage(e.attachTo,e.message,{"position":{"my":"left top","at":"right center"},"css":{"width":"120px;","color":"#fff"},"closeOthers":!1,"dismissable":!1})),e.changed&&(y.push(e.popup),e.popup=StackExchange.helpers.showMessage(e.attachTo,e.message,{"position":{"my":"left top","at":"right center"},"css":{"width":"120px;","color":"#fff"},"closeOthers":!1,"dismissable":!1})))},P=function(e,t){for(var n="all"===t,i=0;i<e.length&&(e[i].id!=t&&!n||(e[i].popup&&y.push(e[i].popup),e.splice(i,1),n));i++);};this.removeAllErrors=function(){P(v,"all"),P(b,"all"),P(w,"all"),P(x,"all"),StackExchange.helpers.removeMessages()};var R=function(e,t){for(var n=!1,i=0;i<e.length;i++)if(e[i].id==t.id){t.changed=e[i].message==t.message,e[i].message=t.message,n=!0;break}n||(t.changed=!0,t.index>=e.length?e.push(t):e.splice(t.index,0,t))},q=function(e){var t=$("input[name = 'password']"),n=0===$.trim(t.val()).length;if(n&&!e?R(b,{"id":"pw-empty","index":0,"attachTo":t,"message":"Password cannot be empty."}):P(b,"pw-empty"),openid.is_signup_page||openid.is_password_page){j(t,b);var i=$.trim(t.val()),a=$("input[name='password2']"),o=$.trim(a.val());0==o.length?R(b,{"id":"pw-empty2","index":3,"attachTo":a,"message":"Password confirmation cannot be empty."}):P(b,"pw-empty2"),o.length>0&&i!=o?R(b,{"id":"pw-match","index":4,"attachTo":a,"message":"The passwords do not match."}):P(b,"pw-match")}},O=function(e){for(var t={},n=0;n<e.length;n++)t[e[n]]++;var i=0;for(var a in t)t.hasOwnProperty(a)&&i++;return i},j=function(e,t){var n=15,i=8,a=e.val(),o=/[a-z]/,r=/[A-Z]/,s=/\d/,c=/(_|[^\w\d])/,l=o.test(e.val()),u=r.test(e.val()),d=s.test(e.val()),h=c.test(e.val()),f=0;if(l&&f++,u&&f++,d&&f++,h&&f++,2==f&&a.length>=n)return P(b,"pw-weak"),P(b,"pw-short"),void 0;var p=$("<span><p>"+function(e){return"Please add one of the following things to make your password stronger:"+e.ep+e.ul+e.uc+"uppercase letters"+e.endli+e.lc+"lowercase letters"+e.endli+e.num+"numbers"+e.endli+e.sc+"special characters"+e.endli+e.endul}({"ul":"<ul>","ep":"</p>","endul":"</ul>","endli":"</li>","uc":'<li id="uc">',"lc":'<li id="lc">',"num":'<li id="num">',"sc":'<li id="sc">'})+"</span>");if(3>f){var g=p.find("#uc"),m=p.find("#lc"),v=p.find("#sc"),w=p.find("#num");l&&m.remove(),u&&g.remove(),d&&w.remove(),h&&v.remove(),R(t,{"id":"pw-weak","index":1,"attachTo":e,"message":p})}else P(t,"pw-weak");var x=O(e.val());if(i>x){var y=i-x;R(t,{"id":"pw-short","index":2,"attachTo":e,"message":function(e){return 1==e.remaining?"Must contain at least "+e.remaining+" more unique character.":"Must contain at least "+e.remaining+" more unique characters."}({"remaining":y})})}else P(t,"pw-short")},L=function(){var e=$("input[name='email']"),t=0===$.trim(e.val()).length;t?R(v,{"id":"em-empty","index":0,"attachTo":e,"message":"Email cannot be empty."}):P(v,"em-empty")},D=function(){var e=$("input[name = 'recaptcha_response_field']"),t=e.length>0,n=t&&0===e.val().length;n?R(x,{"id":"cp","index":0,"attachTo":e,"message":"CAPTCHA cannot be empty."}):P(x,"cp")},U=function(){var e=$.trim($("input[name='email']").val()).toUpperCase(),t=$("input[name='display-name']"),n=$.trim(t.val()).toUpperCase();e===n&&""!=e?R(w,{"id":"nm","index":0,"attachTo":t,"message":"Name and email address must be different. If you don't want to enter a name, just leave it blank.","faileType":"name_email_same"}):P(w,"nm")}},"isSeForm":function(){return openid.is_password_page||openid.seLogin.height()>20},"removeAllErrors":function(){},"toggleStackExchange":function(e){if(e&&$(e.target).parents(".form-bottom").length>0)return!0;var t=$(".preferred-login").height();e&&Math.max($(e.target).offset().top-openid.seLogin.offset().top,e.offsetY)>t||(openid.isSeForm()?openid.collapseStackExchange():openid.expandStackExchange())},"toggleLargeProvider":function(e){if(e&&$(e.target).parents(".large-username").length>0)return!0;var t=$(e.target).closest(".preferred-login"),n=t.height();n>20?openid.collapseLargeProvider(t):openid.expandLargeProvider(t)},"expandLargeProvider":function(e){openid.setPref("showSELogin",!1),openid.removeAllErrors(),e.animate({"height":60},400),$(e.find("p")[1]).fadeIn()},"collapseLargeProvider":function(e){$(e.find("p")[1]).fadeOut(),e.animate({"height":16},400)},"expandStackExchange":function(){openid.setPref("showSELogin",!0);var e=258;openid.is_signup_page&&openid.needs_catpcha&&(e=443),$("#forgot-password").fadeOut(400),openid.seLogin.stop(!0).animate({"height":openid.seLogin.data("full-height"),"width":e},400),openid.collapseExtraProviders(),openid.is_login_page&&StackExchange.using("gps",function(){StackExchange.gps.track("login.start",{},!0)})},"collapseStackExchange":function(e){openid.setPref("showSELogin",!1);var t=$(".preferred-login").height();openid.seLogin.css("overflow","hidden"),e?(openid.seLogin.height(t),$("#forgot-password").fadeIn(),openid.removeAllErrors()):openid.seLogin.animate({"height":t,"width":258},400,function(){$("#forgot-password").fadeIn(),openid.removeAllErrors()})},"toggleExtraProviders":function(e){openid.prefs.showMoreOpenIdOptions?openid.collapseExtraProviders(e):openid.expandExtraProviders(e)},"expandExtraProviders":function(e){openid.setPref("showMoreOpenIdOptions",!0),e?$("#show-more-options").show():$("#show-more-options").fadeIn(),openid.collapseStackExchange(!0)},"collapseExtraProviders":function(e){openid.setPref("showMoreOpenIdOptions",!1),e?$("#show-more-options").hide():$("#show-more-options").fadeOut()},"facebookLogin":function(e,t){$("."+t).css("cursor","wait"),openid.facebook_app_id?openid.doJsFacebookLogin():(this.setOAuthInfo(e.oauth_version,e.oauth_server),$("#openid_form").submit())},"oauth2Login":function(e,t){$("."+t).css("cursor","wait"),this.setOAuthInfo(e.oauth_version,e.oauth_server),$("#openid_form").submit()},"doJsFacebookLogin":function(e){window.FB.login(function(t){if(t.authResponse){var n="/users/oauth/facebook/js?accessToken="+encodeURI(t.authResponse.accessToken)+"&fkey="+encodeURI(StackExchange.options.user.fkey);e&&(n+="&returnUrl="+encodeURI(e)),window.location=n}},openid.facebook_login_params)},"signin":function(e,t,n){function i(e){var t="users_login";openid.is_signup_page&&(t="signup_page",StackExchange.using("gps",function(){StackExchange.gps.track("signup.start",{"location":t},!0)})),e&&StackExchange.using("gps",function(){StackExchange.gps.track("openid.click",{"openid_provider":e,"location":t},!0)})}function a(e){var t={"name":e.data("provider")};return e.data("url")&&(t.url=e.data("url")),e.data("label")&&(t.label=e.data("label")),e.data("oauthserver")&&(t.oauth_server=e.data("oauthserver")),e.data("oauthversion")&&(t.oauth_version=e.attr("data-oauthversion")),t}var o=e.data?a(e):e;return openid.setPref("name",o.name),"stack_exchange"==o.name?(openid.setOpenIdUrl(""),i("Stack Exchange"),void 0):o?(i(o.name.replace(/_/g," ")),"facebook"==o.name?(this.facebookLogin(o,o.name),void 0):"google"!=o.name&&"vk"!=o.name||"2.0"!=o.oauth_version?(this.highlight(o.name),"openid"==o.name?($("#openid_input_area").hide(),this.setOpenIdUrl(""),$("#openid_identifier").focus(),void 0):(o.label&&""!=o.label?(n?openid.using_universal_ui||this.useLargeInputBox(t):this.useInputBox(o),this.setPref("label",o.label),this.provider_url=o.url):(this.setPref("label",""),$("."+o.name).css("cursor","wait"),this.setOpenIdUrl(o.url),this.provider_url=null,$("#openid_form").submit()),void 0)):(this.oauth2Login(o,o.name),void 0)):void 0},"submitx":function(){var e=$("#openid_username").val();if(openid.setPref("username",e),openid.setPref("openid",$("#openid_identifier").val()),""==e)return!0;$("body").css("cursor","wait"),$("#openid_submit").css("cursor","wait"),$("#se-login input[type=submit]",this).attr("disabled","disabled");var t=openid.provider_url;return t&&(t=t.replace("{username}",e),openid.setPref("openid",t),openid.setOpenIdUrl(t)),openid.is_login_page&&StackExchange.using("gps",function(){StackExchange.gps.track("login.start",{},!0)}),openid.is_signup_page&&StackExchange.using("gps",function(){StackExchange.gps.track("signup.start",{"location":"signup_page"},!0)}),!0},"setOpenIdUrl":function(e){$("#openid_identifier").val(e),$("#oauth_version").val(""),$("#oauth_server").val(""),openid.setPref("oauth_version",""),openid.setPref("oauth_server",""),openid.setPref("openid",e)},"setOAuthInfo":function(e,t){$("#oauth_version").val(e),$("#oauth_server").val(t),$("#openid_identifier").val(""),openid.setPref("oauth_version",e),openid.setPref("oauth_server",t),openid.setPref("openid","")},"highlight":function(e){$("#more-openid-options a.openid_highlight").removeClass("openid_highlight"),$("."+e).addClass("openid_highlight")},"useInputBox":function(e){$("#openid_provider_label").html(e.label),$("#openid_input_area").show(),$("#openid_username").val("").focus()},"useLargeInputBox":function(e){this.toggleLargeProvider(e)}};